{"version":3,"file":"ajax.min.js","sources":["../index.js"],"sourcesContent":["const GET = 'GET'\nconst e = encodeURIComponent\n\nfunction defaultObject() {\n  return {\n    method: GET,\n    async: true,\n    data: {},\n    headers: {}\n  }\n}\n\nfunction setHeader(xhr, obj) {\n  for (const key in obj.headers) xhr.setRequestHeader(key, obj.headers[key])\n}\n\nfunction param(obj) {\n  const data = obj.data\n  const isGet = obj.method === GET\n  const isData = Object.keys(data).length\n  if (isData && isGet) {\n    const arr = []\n    for (const i in data) {\n      const isHasOwnProperty = Object.prototype.hasOwnProperty.call(data, i)\n      if (isHasOwnProperty) {\n        arr.push(e(i) + '=' + e(data[i]))\n      }\n    }\n    obj.url += /\\?$/.test(obj.url) ? '' : '?'\n    obj.url += arr.join('&')\n  }\n}\n\nfunction methods(xhr, obj) {\n  param(obj)\n  xhr.open(obj.method, obj.url, obj.async, obj.username, obj.password)\n  setHeader(xhr, obj)\n  switch (obj.method) {\n    case GET:\n      xhr.send()\n      break\n    case 'POST':\n      xhr.send(JSON.stringify(obj.data))\n      break\n  }\n}\n\nfunction Response(xhr, obj) {\n  try {\n    const type =\n      obj.responseType || xhr.getResponseHeader('Content-Type')?.split(';')[0]\n\n    const text = xhr.responseText\n    const xml = xhr.responseXML\n\n    if (type && (text || xml)) {\n      switch (decodeURIComponent(type)) {\n        case 'text/xml':\n        case 'xml':\n          return xml\n        case 'text/json':\n        case 'application/json':\n        case 'text/javascript':\n        case 'application/javascript':\n        case 'application/x-javascript':\n        case 'json':\n          return JSON.parse(text)\n      }\n    }\n    return text\n  } catch (e) {\n    return xhr\n  }\n}\n\n/**\n *\n * 封装ajax请求\n * @param {Object} obj 请求参数\n * @returns {Promise}\n */\nfunction ajax(object) {\n  if (!object) return object\n  return new Promise((resolve, reject) => {\n    if ('object' !== typeof object) object = { url: object }\n    const xhr = new XMLHttpRequest()\n    const obj = Object.assign(defaultObject(), object)\n    obj.method = obj.method.toUpperCase()\n    methods(xhr, obj) // 请求方法\n\n    // 超时\n    let timer\n    if (obj.timeout) timer = setTimeout(() => xhr.abort(), obj.timeout)\n\n    xhr.onreadystatechange = () => {\n      try {\n        if (xhr.readyState === 4) {\n          if (timer) clearTimeout(timer) // 清理超时(不执行xhr.abort())\n\n          const isSuccess = xhr.status >= 200 && xhr.status < 300\n          if (isSuccess) resolve(Response(xhr, obj))\n          else reject(xhr)\n        }\n      } catch (error) {\n        reject(error)\n      }\n    }\n  })\n}\n\nexport default ajax\n"],"names":["GET","e","encodeURIComponent","methods","xhr","obj","data","isGet","method","isData","Object","keys","length","arr","i","prototype","hasOwnProperty","call","push","url","test","join","param","open","async","username","password","key","headers","setRequestHeader","setHeader","send","JSON","stringify","object","Promise","resolve","reject","timer","XMLHttpRequest","assign","toUpperCase","timeout","setTimeout","abort","onreadystatechange","readyState","clearTimeout","status","_xhr$getResponseHeade","type","responseType","getResponseHeader","split","text","responseText","xml","responseXML","decodeURIComponent","parse","Response","error"],"mappings":"uQAAA,IAAMA,EAAM,MACNC,EAAIC,mBAgCV,SAASC,EAAQC,EAAKC,GAIZA,OArBV,SAAeA,GACb,IAAMC,EAAOD,EAAIC,KACXC,EAAQF,EAAIG,SAAWR,EAEzBS,GADWC,OAAOC,KAAKL,GAAMM,QACnBL,EAAO,CACbM,IAAAA,EAAM,GACZ,IAAK,IAAMC,KAAKR,EACWI,OAAOK,UAAUC,eAAeC,KAAKX,EAAMQ,IAElED,EAAIK,KAAKjB,EAAEa,GAAK,IAAMb,EAAEK,EAAKQ,KAGjCT,EAAIc,KAAO,MAAMC,KAAKf,EAAIc,KAAO,GAAK,IACtCd,EAAIc,KAAON,EAAIQ,KAAK,MAKtBC,CAAMjB,GACND,EAAImB,KAAKlB,EAAIG,OAAQH,EAAIc,IAAKd,EAAImB,MAAOnB,EAAIoB,SAAUpB,EAAIqB,UAvB7D,SAAmBtB,EAAKC,GACtB,IAAK,IAAMsB,KAAOtB,EAAIuB,QAASxB,EAAIyB,iBAAiBF,EAAKtB,EAAIuB,QAAQD,IAuBrEG,CAAU1B,EAAKC,GACPA,EAAIG,QACV,KAAKR,EACHI,EAAI2B,OACJ,MACF,IAAK,OACH3B,EAAI2B,KAAKC,KAAKC,UAAU5B,EAAIC,eAuClC,SAAc4B,GACZ,OAAKA,EACE,IAAIC,SAAQ,SAACC,EAASC,GACvB,WAAoBH,EAAAA,KAAQA,EAAS,CAAEf,IAAKe,IAChD,IAMII,EANElC,EAAM,IAAImC,eACVlC,EAAMK,OAAO8B,OAlFd,CACLhC,OAAQR,EACRwB,OAAO,EACPlB,KAAM,GACNsB,QAAS,IA8EkCM,GAC3C7B,EAAIG,OAASH,EAAIG,OAAOiC,cACxBtC,EAAQC,EAAKC,GAITA,EAAIqC,UAASJ,EAAQK,YAAW,WAAMvC,OAAAA,EAAIwC,UAASvC,EAAIqC,UAE3DtC,EAAIyC,mBAAqB,WACnB,IACF,GAAuB,IAAnBzC,EAAI0C,WACFR,GAAOS,aAAaT,GAENlC,EAAI4C,QAAU,KAAO5C,EAAI4C,OAAS,IACrCZ,EArDzB,SAAkBhC,EAAKC,GACjB,IAAA,IAAA4C,EACIC,EACJ7C,EAAI8C,eAAJ,QAAoB/C,EAAAA,EAAIgD,kBAAkB,uBAA1C,IAAAH,OAAA,EAAoBA,EAAuCI,MAAM,KAAK,IAElEC,EAAOlD,EAAImD,aACXC,EAAMpD,EAAIqD,YAEhB,GAAIP,IAASI,GAAQE,GACXE,OAAAA,mBAAmBR,IACzB,IAAK,WACL,IAAK,MACH,OAAOM,EACT,IAAK,YACL,IAAK,mBACL,IAAK,kBACL,IAAK,yBACL,IAAK,2BACL,IAAK,OACH,OAAOxB,KAAK2B,MAAML,GAGxB,OAAOA,EACP,MAAOrD,GACP,OAAOG,GA6BsBwD,CAASxD,EAAKC,IAChCgC,EAAOjC,GAEd,MAAOyD,GACPxB,EAAOwB,QAtBO3B"}